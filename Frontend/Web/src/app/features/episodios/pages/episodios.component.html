<header>
  <h2>Episodios</h2>
</header>
<div class="container">
  <section class="layout">
    <div class="top-row">
      <div class="card">
        <h3>Filtros</h3>
        <form [formGroup]="filterForm" class="filter-group">
          <div class="form-group">
            <label for="idFilter">ID:</label>
            <input
              type="text"
              id="idFilter"
              name="idFilter"
              placeholder="ID"
              formControlName="idFilter"
              class="form-control"
            />
            @let idControl = filterForm.controls.idFilter; @if
            (idControl.invalid && (idControl.dirty || idControl.touched)) {
            <div
              style="
                color: #d9534f;
                font-size: 0.8rem;
                font-weight: bold;
                margin-top: 4px;
              "
            >
              @if (idControl.hasError('pattern')) {
              <span>&#9679; Solo se aceptan nÃºmeros.</span>
              }
            </div>
            }
          </div>

          <div class="form-group">
            <label for="nombreFilter">Nombre:</label>
            <input
              type="text"
              id="nombreFilter"
              name="nombreFilter"
              placeholder="Nombre del episodio"
              formControlName="nombreFilter"
              class="form-control"
            />
            @let nombreControl = filterForm.controls.nombreFilter; @if
            (nombreControl.invalid && (nombreControl.dirty ||
            nombreControl.touched)) {
            <div
              style="
                color: #f2a202;
                font-size: 0.8rem;
                font-weight: bold;
                margin-top: 4px;
              "
            >
              @if (nombreControl.hasError('minlength')) {
              <span>&#9679; El nombre debe tener al menos 3 caracteres.</span>
              }
            </div>
            }
          </div>

          <div class="filter-actions">
            <button
              [disabled]="isFilterEmpty"
              class="select-btn"
              (click)="clearFilters()"
            >
              Limpiar filtros
            </button>
          </div>
        </form>
      </div>

      <div class="card">
        <h3>Detalle</h3>

        <div *ngIf="selectedEpisodio; else noSelection">
          <div class="card-header">
            <h4>{{ selectedEpisodio.nombre }}</h4>
            <p class="subtitle">ID {{ selectedEpisodio.id }}</p>
          </div>
          <div class="card-body">
            <p><strong>Emitido en:</strong> {{ selectedEpisodio.emitidoEn }}</p>
            <p>
              <strong>Temporada/Episodio:</strong>
              {{ selectedEpisodio.temporadaConNumeroEpisodio }}
            </p>
          </div>
        </div>

        <ng-template #noSelection>
          <p class="episode-meta">
            Selecciona una fila de la tabla para ver sus detalles.
          </p>
        </ng-template>
      </div>
    </div>

    <div class="card">
      <h3>Listado</h3>
      <p class="episode-meta">
        PÃ¡gina {{ currentPage }} de {{ totalPages() }} - Total de
        {{ this.totalIems() }} resultados
      </p>

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Emitido En</th>
            <th>Temp/Episodio</th>
            <th>AcciÃ³n</th>
          </tr>
        </thead>
        <tbody>
          @for (episodio of this.episodiosService.episodiosPaginated()?.data!;
          track episodio.id) {
          <tr [class.selected]="episodio === selectedEpisodio">
            <td>{{ episodio.id }}</td>
            <td>{{ episodio.nombre }}</td>
            <td>{{ episodio.emitidoEn }}</td>
            <td>{{ episodio.temporadaConNumeroEpisodio }}</td>
            <td>
              <button class="select-btn" (click)="selectEpisodio(episodio)">
                {{ episodio === selectedEpisodio ? 'Deseleccionar' : 'ðŸ”Ž' }}
              </button>
            </td>
          </tr>
          } @if (this.episodiosService.episodiosPaginated() === null) {
          <tr>
            <td colspan="5" class="no-data">No se encontraron episodios.</td>
          </tr>
          }
        </tbody>
      </table>

      <div class="paginator">
        <button
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1"
        >
          &laquo;
        </button>

        @for (page of pageNumbers; track page) {
        <button (click)="goToPage(page)" [class.active]="page === currentPage">
          {{ page }}
        </button>
        }

        <button
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === totalPages()"
        >
          &raquo;
        </button>
      </div>
    </div>
  </section>
</div>
